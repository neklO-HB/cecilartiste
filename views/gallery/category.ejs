<%- include('../partials/header') %>
<section class="category-hero" aria-labelledby="category-hero-title" style="--category-hero-image: url('<%= category.hero_image_path || '' %>')">
    <div class="category-hero__overlay"></div>
    <div class="category-hero__content">
        <p class="category-hero__eyebrow">Galerie thématique</p>
        <h1 id="category-hero-title"><%= category.name %></h1>
        <p>
            <% if (category.description) { %>
                <%- nl2br(category.description) %>
            <% } else { %>
                Une ambiance à composer : ajoutez vos photos pour révéler la personnalité de cette collection.
            <% } %>
        </p>
        <span class="category-hero__badge"><%= category.photo_count %> photo<%= category.photo_count > 1 ? 's' : '' %> disponibles</span>
        <a class="button button--ghost" href="/contact">Imaginer mon reportage</a>
    </div>
</section>
<section class="category-viewer" aria-labelledby="category-viewer-title">
    <header class="category-viewer__intro">
        <h2 id="category-viewer-title">Visionneuse immersive</h2>
        <p>
            Parcourez les images en scroll horizontal ou au clavier pour une expérience fluide. Chaque photo profite d'un traitement dynamique et d'effets lumineux subtils.
        </p>
    </header>
    <% if (photos && photos.length > 0) { %>
        <div class="category-viewer__carousel" role="list">
            <% photos.forEach((photo, index) => { %>
                <% const photoDescription = (photo.description || '').replace(/\r?\n/g, ' '); %>
                <figure class="category-viewer__item" role="listitem" style="--category-viewer-accent: <%= photo.accent_color || '#ff6f61' %>; --category-viewer-index: <%= index %>" data-photo-index="<%= index %>" data-photo-src="<%= photo.image_path %>" data-photo-title="<%= photo.title %>" data-photo-description="<%= photoDescription %>">
                    <div class="category-viewer__image-wrapper">
                        <img src="<%= photo.image_path %>" alt="<%= photo.title %>">
                        <span class="category-viewer__glow" aria-hidden="true"></span>
                    </div>
                    <figcaption class="category-viewer__caption">
                        <h3><%= photo.title %></h3>
                        <% if (photo.description) { %>
                            <p><%- nl2br(photo.description) %></p>
                        <% } %>
                    </figcaption>
                    <button type="button" class="category-viewer__trigger" aria-label="Ouvrir la photo &laquo;&nbsp;<%= photo.title %>&nbsp;&raquo; en plein écran">
                        <span class="sr-only">Afficher la photo <%= photo.title %> dans la visionneuse</span>
                    </button>
                </figure>
            <% }) %>
        </div>
        <div id="gallery-lightbox" class="gallery-lightbox" hidden aria-hidden="true">
            <div class="gallery-lightbox__overlay" data-gallery-close></div>
            <div class="gallery-lightbox__dialog" role="dialog" aria-modal="true" aria-labelledby="gallery-lightbox-title">
                <button type="button" class="gallery-lightbox__nav gallery-lightbox__nav--prev" aria-label="Photo précédente">
                    <span aria-hidden="true">‹</span>
                </button>
                <figure class="gallery-lightbox__figure">
                    <img class="gallery-lightbox__image" src="" alt="">
                    <figcaption class="gallery-lightbox__caption">
                        <div class="gallery-lightbox__meta">
                            <p class="gallery-lightbox__counter" aria-live="polite"></p>
                        </div>
                        <h3 id="gallery-lightbox-title" class="gallery-lightbox__title"></h3>
                        <p class="gallery-lightbox__description"></p>
                    </figcaption>
                </figure>
                <button type="button" class="gallery-lightbox__nav gallery-lightbox__nav--next" aria-label="Photo suivante">
                    <span aria-hidden="true">›</span>
                </button>
                <button type="button" class="gallery-lightbox__close" aria-label="Fermer la visionneuse">×</button>
            </div>
        </div>
    <% } else { %>
        <div class="category-viewer__empty">
            <p>Aucune photo n'est encore associée à cette catégorie. Ajoutez des images depuis l'administration pour dévoiler cette galerie.</p>
            <a class="button" href="/admin">Ajouter des photos</a>
        </div>
    <% } %>
</section>
<%- include('../partials/footer') %>
